<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ä»Šä¸ç»¸ä¹‹è·¯</title>
    <style>
        :root {
            --primary-color: #8B4513;
            --secondary-color: #D2691E;
            --accent-color: #CD853F;
            --light-color: #F5DEB3;
            --dark-color: #654321;
            --text-color: #5C4033;
            --ancient-bg: #F5E6CA;
            --modern-bg: #E8F4F8;
            --success-color: #27ae60;
            --error-color: #e74c3c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'SimSun', sans-serif;
        }
        
        body {
            background-color: var(--light-color);
            color: var(--text-color);
            overflow: hidden;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.05"><path d="M0,50 L100,50 M50,0 L50,100" stroke="%235C4033" stroke-width="0.5"/></svg>');
        }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .progress-container {
            flex: 1;
            margin: 0 20px;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .progress-bar {
            height: 10px;
            background-color: rgba(255,255,255,0.3);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: var(--light-color);
            width: 0%;
            transition: width 0.5s;
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* åœ°å›¾åŒºåŸŸ */
        .map-container {
            flex: 2;
            position: relative;
            background-color: #E9DCC9;
            overflow: hidden;
            border-right: 2px solid var(--primary-color);
        }
        
        #silk-road-map {
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .city-marker {
            position: absolute;
            width: 24px;
            height: 24px;
            background-color: var(--primary-color);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            box-shadow: 0 0 8px rgba(0,0,0,0.5);
            transition: all 0.3s;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .city-marker:hover {
            width: 28px;
            height: 28px;
            background-color: var(--secondary-color);
        }
        
        .city-marker.visited {
            background-color: var(--accent-color);
        }
        
        .city-name {
            position: absolute;
            font-size: 14px;
            color: var(--text-color);
            pointer-events: none;
            white-space: nowrap;
            background-color: rgba(255,255,255,0.8);
            padding: 3px 8px;
            border-radius: 4px;
            transform: translate(-50%, 15px);
            z-index: 5;
            border: 1px solid var(--accent-color);
        }
        
        /* ä¿¡æ¯é¢æ¿ */
        .info-panel {
            flex: 1;
            background-color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
            box-shadow: -2px 0 5px rgba(0,0,0,0.1);
        }
        
        .city-info {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .era-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--accent-color);
        }
        
        .era-tab {
            padding: 8px 15px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .era-tab.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: bold;
        }
        
        .era-content {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .era-content.active {
            display: block;
        }
        
        .era-image {
            width: 100%;
            height: 150px;
            background-color: #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #777;
        }
        
        .goods-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .goods-item {
            background-color: white;
            border: 1px solid var(--accent-color);
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.9rem;
        }
        
        /* é…å¯¹æ¸¸æˆ */
        .matching-game {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .matching-instructions {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .matching-area {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        
        .matching-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .matching-column h4 {
            text-align: center;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .matching-item {
            background-color: white;
            border: 2px solid var(--accent-color);
            border-radius: 5px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .matching-item:hover {
            background-color: #f0f0f0;
        }
        
        .matching-item.selected {
            border-color: var(--primary-color);
            background-color: #ffeaa7;
        }
        
        .matching-item.matched {
            border-color: var(--success-color);
            background-color: #d5f5e3;
        }
        
        .matching-feedback {
            text-align: center;
            margin-top: 10px;
            min-height: 20px;
            font-weight: bold;
        }
        
        /* æˆå°±é¢æ¿ */
        .achievements {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .achievement-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .achievement-item {
            width: 60px;
            height: 60px;
            background-color: white;
            border: 1px solid var(--accent-color);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.3s;
        }
        
        .achievement-item.unlocked {
            border-color: var(--primary-color);
            transform: scale(1.05);
        }
        
        .achievement-item .lock {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.7rem;
            color: var(--error-color);
        }
        
        /* æ—¶é—´çº¿ */
        .timeline {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .timeline-container {
            position: relative;
            height: 60px;
            margin-top: 10px;
        }
        
        .timeline-line {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--accent-color);
            transform: translateY(-50%);
        }
        
        .timeline-marker {
            position: absolute;
            top: 50%;
            width: 12px;
            height: 12px;
            background-color: var(--primary-color);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .timeline-marker:hover, .timeline-marker.active {
            width: 16px;
            height: 16px;
            background-color: var(--secondary-color);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .map-container {
                border-right: none;
                border-bottom: 2px solid var(--primary-color);
                height: 40%;
            }
            
            .matching-area {
                flex-direction: column;
            }
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background-color: var(--light-color);
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            padding: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            text-align: center;
        }
        
        .modal-title {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .modal-close {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 15px;
        }
        
        /* æ“ä½œæŒ‡å¼• */
        .instructions {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: rgba(255,255,255,0.8);
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            max-width: 300px;
            z-index: 15;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <div class="top-nav">
            <div class="logo">å¤ä»Šä¸ç»¸ä¹‹è·¯</div>
            <div class="progress-container">
                <div class="progress-info">
                    <span>æ¢ç´¢è¿›åº¦</span>
                    <span id="progress-percent">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress" id="progress-bar"></div>
                </div>
            </div>
            <div class="player-info">æ–‡åŒ–æ¢é™©è€…</div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <!-- åœ°å›¾åŒºåŸŸ -->
            <div class="map-container">
                <canvas id="silk-road-map"></canvas>
                <!-- åŸå¸‚æ ‡è®°å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                
                <!-- æ“ä½œæŒ‡å¼• -->
                <div class="instructions">
                    <strong>æ“ä½œæŒ‡å¼•ï¼š</strong><br>
                    1. ç‚¹å‡»åœ°å›¾ä¸Šçš„åŸå¸‚æ ‡è®°<br>
                    2. æŸ¥çœ‹å¤ä»£å’Œç°ä»£ä¿¡æ¯<br>
                    3. å®Œæˆå¤ä»Šç‰©å“é…å¯¹æ¸¸æˆ<br>
                    4. æ”¶é›†æˆå°±
                </div>
            </div>
            
            <!-- ä¿¡æ¯é¢æ¿ -->
            <div class="info-panel">
                <div class="city-info">
                    <h2 id="current-city">ç‚¹å‡»åœ°å›¾ä¸Šçš„åŸå¸‚å¼€å§‹æ¢ç´¢</h2>
                    <div class="era-tabs">
                        <div class="era-tab active" data-era="ancient">å¤ä»£</div>
                        <div class="era-tab" data-era="modern">ç°ä»£</div>
                    </div>
                    <div class="era-content active" id="ancient-content">
                        <p>é€‰æ‹©ä¸€ä¸ªåŸå¸‚ä»¥æŸ¥çœ‹å…¶å¤ä»£é¢è²Œ</p>
                    </div>
                    <div class="era-content" id="modern-content">
                        <p>é€‰æ‹©ä¸€ä¸ªåŸå¸‚ä»¥æŸ¥çœ‹å…¶ç°ä»£é¢è²Œ</p>
                    </div>
                </div>
                
                <div class="matching-game">
                    <h3>å¤ä»Šé…å¯¹</h3>
                    <div class="matching-instructions">
                        <p>å°†å¤ä»£çš„è´¸æ˜“ç‰©å“ä¸ç°ä»£çš„å¯¹åº”ç‰©å“è¿›è¡Œé…å¯¹</p>
                    </div>
                    <div class="matching-area">
                        <div class="matching-column">
                            <h4>å¤ä»£ç‰©å“</h4>
                            <div id="ancient-items">
                                <!-- å¤ä»£ç‰©å“å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                            </div>
                        </div>
                        <div class="matching-column">
                            <h4>ç°ä»£ç‰©å“</h4>
                            <div id="modern-items">
                                <!-- ç°ä»£ç‰©å“å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                            </div>
                        </div>
                    </div>
                    <div class="matching-feedback" id="matching-feedback"></div>
                </div>
                
                <div class="achievements">
                    <h3>æ”¶é›†æˆå°±</h3>
                    <div class="achievement-list" id="achievement-container">
                        <!-- æˆå°±å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
                
                <div class="timeline">
                    <h3>ä¸ç»¸ä¹‹è·¯æ—¶é—´çº¿</h3>
                    <div class="timeline-container">
                        <div class="timeline-line"></div>
                        <!-- æ—¶é—´çº¿æ ‡è®°å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æˆå°±è§£é”æ¨¡æ€æ¡† -->
    <div id="achievement-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2 class="modal-title">æˆå°±è§£é”ï¼</h2>
            <div id="achievement-details">
                <!-- æˆå°±è¯¦æƒ…å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
            <button class="modal-close" id="close-achievement-btn">ç»§ç»­æ¢ç´¢</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®
        const gameData = {
            cities: {
                xiAn: {
                    name: "è¥¿å®‰",
                    ancient: {
                        name: "é•¿å®‰",
                        description: "é•¿å®‰æ˜¯ä¸ç»¸ä¹‹è·¯çš„èµ·ç‚¹ï¼Œä½œä¸ºå¤§å”å¸å›½çš„é¦–éƒ½ï¼Œæ˜¯å½“æ—¶ä¸–ç•Œä¸Šæœ€å¤§ã€æœ€ç¹åçš„åŸå¸‚ä¹‹ä¸€ã€‚æ¥è‡ªä¸–ç•Œå„åœ°çš„å•†äººã€åƒ§ä¾£å’Œä½¿èŠ‚æ±‡èšäºæ­¤ï¼Œè¿›è¡Œæ–‡åŒ–å’Œå•†å“äº¤æµã€‚é•¿å®‰åŸå¸ƒå±€è§„æ•´ï¼Œå¸‚åœºç¹è£ï¼Œæ˜¯ä¸œæ–¹æ–‡æ˜çš„ç’€ç’¨æ˜ç ã€‚",
                        goods: ["ä¸ç»¸", "ç“·å™¨", "èŒ¶å¶", "çº¸å¼ ", "æ¼†å™¨", "é“œé•œ"]
                    },
                    modern: {
                        description: "ç°ä»£è¥¿å®‰æ˜¯é™•è¥¿çœçœä¼šï¼Œä¸­å›½è¥¿éƒ¨åœ°åŒºé‡è¦çš„ä¸­å¿ƒåŸå¸‚ã€‚å®ƒæ—¢æ˜¯å†å²æ–‡åŒ–ååŸï¼Œä¹Ÿæ˜¯ç°ä»£åŒ–å¤§éƒ½å¸‚ï¼Œæ˜¯ä¸€å¸¦ä¸€è·¯å€¡è®®çš„é‡è¦èŠ‚ç‚¹åŸå¸‚ã€‚è¥¿å®‰é«˜æ–°æŠ€æœ¯äº§ä¸šå¼€å‘åŒºã€æ›²æ±Ÿæ–°åŒºç­‰ç°ä»£åŒ–åŒºåŸŸä¸å¤åŸå¢™ã€é’Ÿé¼“æ¥¼ç­‰å†å²é—è¿¹å’Œè°å…±å­˜ã€‚",
                        goods: ["ç”µå­äº§å“", "æœºæ¢°è®¾å¤‡", "å†œäº§å“", "çººç»‡å“", "æ±½è½¦é›¶éƒ¨ä»¶", "èˆªç©ºèˆªå¤©è®¾å¤‡"]
                    },
                    position: { x: 0.1, y: 0.5 },
                    matches: [
                        { ancient: "ä¸ç»¸", modern: "çººç»‡å“" },
                        { ancient: "ç“·å™¨", modern: "å·¥è‰ºå“" },
                        { ancient: "èŒ¶å¶", modern: "å†œäº§å“" }
                    ]
                },
                dunHuang: {
                    name: "æ•¦ç…Œ",
                    ancient: {
                        description: "æ•¦ç…Œæ˜¯ä¸ç»¸ä¹‹è·¯ä¸Šçš„é‡è¦æ¢çº½ï¼Œä»¥è«é«˜çªŸé—»åäºä¸–ã€‚è¿™é‡Œæ˜¯ä¸œè¥¿æ–¹æ–‡åŒ–äº¤æµçš„é‡è¦èŠ‚ç‚¹ï¼Œä½›æ•™è‰ºæœ¯åœ¨æ­¤è¾¾åˆ°å·…å³°ã€‚æ•¦ç…Œä½œä¸ºæ²³è¥¿èµ°å»Šçš„é—¨æˆ·ï¼Œè§è¯äº†æ— æ•°å•†é˜Ÿã€åƒ§ä¾£å’Œä½¿èŠ‚çš„å¾€æ¥ã€‚",
                        goods: ["ç‰çŸ³", "é¦™æ–™", "ä½›ç»", "å£ç”»", "éª†é©¼", "è¯æ"]
                    },
                    modern: {
                        description: "ç°ä»£æ•¦ç…Œæ˜¯ä¸–ç•Œæ–‡åŒ–é—äº§åœ°ï¼Œä»¥æ—…æ¸¸ä¸šä¸ºä¸»è¦äº§ä¸šã€‚è«é«˜çªŸã€é¸£æ²™å±±å’Œæœˆç‰™æ³‰å¸å¼•ç€å…¨çƒæ¸¸å®¢ï¼ŒåŒæ—¶æ–°èƒ½æºäº§ä¸šä¹Ÿåœ¨å¿«é€Ÿå‘å±•ã€‚æ•¦ç…Œæ–‡åšä¼šçš„ä¸¾åŠè¿›ä¸€æ­¥æå‡äº†å…¶å›½é™…å½±å“åŠ›ã€‚",
                        goods: ["æ—…æ¸¸æœåŠ¡", "æ–‡åˆ›äº§å“", "æ–°èƒ½æºè®¾å¤‡", "å†œäº§å“", "æ‰‹å·¥è‰ºå“", "æ•°å­—æ–‡åŒ–äº§å“"]
                    },
                    position: { x: 0.3, y: 0.45 },
                    matches: [
                        { ancient: "ä½›ç»", modern: "æ–‡åˆ›äº§å“" },
                        { ancient: "å£ç”»", modern: "æ‰‹å·¥è‰ºå“" },
                        { ancient: "é¦™æ–™", modern: "å†œäº§å“" }
                    ]
                },
                samarKand: {
                    name: "æ’’é©¬å°”ç½•",
                    ancient: {
                        description: "æ’’é©¬å°”ç½•æ˜¯ä¸­äºšæœ€å¤è€çš„åŸå¸‚ä¹‹ä¸€ï¼Œä¸ç»¸ä¹‹è·¯ä¸Šçš„é‡è¦æ¢çº½ã€‚ä»¥å…¶è“è‰²åœ†é¡¶å»ºç­‘å’Œä¼Šæ–¯å…°å­¦æœ¯ä¸­å¿ƒé—»åï¼Œæ˜¯å¸–æœ¨å„¿å¸å›½çš„é¦–éƒ½ã€‚è¿™é‡Œçš„é›·å‰æ–¯å¦å¹¿åœºæ˜¯å¤ä»£ä¼Šæ–¯å…°æ•™è‚²çš„ä¸­å¿ƒã€‚",
                        goods: ["å®çŸ³", "ç»ç’ƒå™¨", "åœ°æ¯¯", "é¦™æ–™", "çº¸å¼ ", "é‡‘å±å·¥è‰ºå“"]
                    },
                    modern: {
                        description: "ç°ä»£æ’’é©¬å°”ç½•æ˜¯ä¹Œå…¹åˆ«å…‹æ–¯å¦ç¬¬äºŒå¤§åŸå¸‚ï¼Œè”åˆå›½æ•™ç§‘æ–‡ç»„ç»‡ä¸–ç•Œé—äº§åœ°ã€‚å®ƒä¿ç•™äº†ä¸°å¯Œçš„å†å²é—è¿¹ï¼ŒåŒæ—¶å‘å±•äº†çººç»‡ã€é£Ÿå“åŠ å·¥ç­‰ç°ä»£äº§ä¸šã€‚æ’’é©¬å°”ç½•ä½œä¸ºæ—…æ¸¸åŸå¸‚ï¼Œå¸å¼•ç€ä¸–ç•Œå„åœ°çš„æ¸¸å®¢ã€‚",
                        goods: ["çººç»‡å“", "é£Ÿå“", "æ‰‹å·¥è‰ºå“", "åŒ–å·¥äº§å“", "æœºæ¢°è®¾å¤‡", "æ—…æ¸¸æœåŠ¡"]
                    },
                    position: { x: 0.5, y: 0.4 },
                    matches: [
                        { ancient: "åœ°æ¯¯", modern: "çººç»‡å“" },
                        { ancient: "çº¸å¼ ", modern: "åŒ–å·¥äº§å“" },
                        { ancient: "ç»ç’ƒå™¨", modern: "æ‰‹å·¥è‰ºå“" }
                    ]
                },
                baghdad: {
                    name: "å·´æ ¼è¾¾",
                    ancient: {
                        description: "å·´æ ¼è¾¾æ˜¯é˜¿æ‹”æ–¯ç‹æœçš„é¦–éƒ½ï¼Œä¼Šæ–¯å…°é»„é‡‘æ—¶ä»£çš„å­¦æœ¯ä¸­å¿ƒã€‚è¿™é‡Œçš„æ™ºæ…§å®«æ±‡é›†äº†ä¸–ç•Œå„åœ°çš„å­¦è€…ï¼Œç¿»è¯‘å¹¶å‘å±•äº†å¤å¸Œè…Šã€æ³¢æ–¯å’Œå°åº¦çš„çŸ¥è¯†ã€‚å·´æ ¼è¾¾åœ¨å½“æ—¶æ˜¯ä¸–ç•Œä¸Šæœ€å¯Œåº¶çš„åŸå¸‚ä¹‹ä¸€ã€‚",
                        goods: ["é¦™æ–™", "è¯æ", "ä¹¦ç±", "Quranç»å·", "å¤©æ–‡ä»ªå™¨", "é¦™æ°´"]
                    },
                    modern: {
                        description: "ç°ä»£å·´æ ¼è¾¾æ˜¯ä¼Šæ‹‰å…‹é¦–éƒ½ï¼Œå°½ç®¡ç»å†äº†æˆ˜ä¹±ï¼Œä»ç„¶æ˜¯ä¸­ä¸œåœ°åŒºé‡è¦çš„æ”¿æ²»ã€ç»æµå’Œæ–‡åŒ–ä¸­å¿ƒã€‚çŸ³æ²¹äº§ä¸šæ˜¯å…¶ç»æµæ”¯æŸ±ï¼ŒåŒæ—¶æ­£åœ¨é‡å»ºå†å²æ–‡åŒ–é—è¿¹ï¼Œæ¢å¤å…¶å¾€æ—¥è£å…‰ã€‚",
                        goods: ["çŸ³æ²¹", "çŸ³åŒ–äº§å“", "å»ºç­‘ææ–™", "é£Ÿå“", "è¯å“", "æ—¥ç”¨å“"]
                    },
                    position: { x: 0.7, y: 0.45 },
                    matches: [
                        { ancient: "è¯æ", modern: "è¯å“" },
                        { ancient: "é¦™æ–™", modern: "é£Ÿå“" },
                        { ancient: "å¤©æ–‡ä»ªå™¨", modern: "çŸ³åŒ–äº§å“" }
                    ]
                },
                istanbul: {
                    name: "ä¼Šæ–¯å¦å¸ƒå°”",
                    ancient: {
                        name: "å›å£«å¦ä¸å ¡",
                        description: "å›å£«å¦ä¸å ¡æ˜¯ä¸œç½—é©¬å¸å›½çš„é¦–éƒ½ï¼Œè¿æ¥æ¬§äºšçš„è´¸æ˜“æ¢çº½ã€‚è¿™é‡Œçš„é»„é‡‘è§’æ¹¾æ˜¯å„å›½å•†èˆ¹çš„èšé›†åœ°ï¼Œä¸ç»¸ä¹‹è·¯çš„è¥¿æ–¹ç»ˆç‚¹ã€‚åœ£ç´¢è²äºšå¤§æ•™å ‚æ˜¯æ‹œå åº­å»ºç­‘çš„æ°å‡ºä»£è¡¨ã€‚",
                        goods: ["é‡‘é“¶å™¨", "è‘¡è„é…’", "ä¸œç½—é©¬é‡‘å¸", "ä¸ç»¸", "åœ£åƒ", "ç»ç’ƒåˆ¶å“"]
                    },
                    modern: {
                        description: "ç°ä»£ä¼Šæ–¯å¦å¸ƒå°”æ˜¯åœŸè€³å…¶æœ€å¤§åŸå¸‚ï¼Œæ¨ªè·¨æ¬§äºšå¤§é™†ã€‚å®ƒæ˜¯é‡è¦çš„æ—…æ¸¸ã€æ–‡åŒ–å’Œç»æµä¸­å¿ƒï¼Œä¿ç•™äº†ä¸°å¯Œçš„å†å²é—äº§çš„åŒæ—¶å‘å±•äº†ç°ä»£äº§ä¸šã€‚åšæ–¯æ™®é²æ–¯æµ·å³¡å¤§æ¡¥è¿æ¥ç€æ¬§æ´²å’Œäºšæ´²ã€‚",
                        goods: ["çººç»‡å“", "æ±½è½¦", "ç”µå­äº§å“", "é£Ÿå“", "æ—…æ¸¸æœåŠ¡", "åŒ–å·¥äº§å“"]
                    },
                    position: { x: 0.9, y: 0.4 },
                    matches: [
                        { ancient: "ä¸ç»¸", modern: "çººç»‡å“" },
                        { ancient: "è‘¡è„é…’", modern: "é£Ÿå“" },
                        { ancient: "é‡‘é“¶å™¨", modern: "ç”µå­äº§å“" }
                    ]
                }
            },
            
            timeline: [
                { year: "å…¬å…ƒå‰138å¹´", event: "å¼ éªå‡ºä½¿è¥¿åŸŸ", description: "æ±‰æ­¦å¸æ´¾é£å¼ éªå‡ºä½¿è¥¿åŸŸï¼Œæ­£å¼å¼€è¾Ÿä¸ç»¸ä¹‹è·¯ï¼Œä¿ƒè¿›äº†ä¸œè¥¿æ–¹æ–‡åŒ–äº¤æµã€‚" },
                { year: "å…¬å…ƒ97å¹´", event: "ç­è¶…æ´¾é£ç”˜è‹±å‡ºä½¿ç½—é©¬", description: "ä¸œæ±‰æ—¶æœŸï¼Œç­è¶…æ´¾é£ç”˜è‹±å‡ºä½¿ç½—é©¬å¸å›½ï¼ŒæŠµè¾¾æ³¢æ–¯æ¹¾ï¼Œè¿›ä¸€æ­¥æ‹“å±•äº†ä¸ç»¸ä¹‹è·¯ã€‚" },
                { year: "å…¬å…ƒ629å¹´", event: "ç„å¥˜è¥¿è¡Œ", description: "å”ä»£é«˜åƒ§ç„å¥˜ä»é•¿å®‰å‡ºå‘ï¼Œå‰å¾€å°åº¦å–ç»ï¼Œè‘—æœ‰ã€Šå¤§å”è¥¿åŸŸè®°ã€‹ï¼Œä¿ƒè¿›äº†ä½›æ•™ä¼ æ’­ã€‚" },
                { year: "å…¬å…ƒ1271å¹´", event: "é©¬å¯Â·æ³¢ç½—ä¸œè¡Œ", description: "æ„å¤§åˆ©æ—…è¡Œå®¶é©¬å¯Â·æ³¢ç½—å¯ç¨‹å‰å¾€ä¸­å›½ï¼Œå…¶æ¸¸è®°å‘æ¬§æ´²ä»‹ç»äº†ä¸œæ–¹çš„å¯Œåº¶ä¸æ–‡æ˜ã€‚" },
                { year: "å…¬å…ƒ2013å¹´", event: "ä¸€å¸¦ä¸€è·¯å€¡è®®", description: "ä¸­å›½æå‡ºå…±å»ºä¸ç»¸ä¹‹è·¯ç»æµå¸¦å’Œ21ä¸–çºªæµ·ä¸Šä¸ç»¸ä¹‹è·¯ï¼Œå¤å…´å¤è€çš„è´¸æ˜“ä¸æ–‡åŒ–é€šé“ã€‚" }
            ],
            
            achievements: [
                { id: "start", name: "èµ·ç‚¹", description: "è®¿é—®ä¸ç»¸ä¹‹è·¯èµ·ç‚¹è¥¿å®‰", icon: "ğŸ" },
                { id: "dunhuang", name: "è‰ºæœ¯å®åº“", description: "æ¢ç´¢æ•¦ç…Œè«é«˜çªŸ", icon: "ğŸ¨" },
                { id: "samarkand", name: "è“è‰²æ˜ç ", description: "è®¿é—®æ’’é©¬å°”ç½•", icon: "ğŸ”·" },
                { id: "baghdad", name: "æ™ºæ…§ä¹‹åŸ", description: "æ¢ç´¢å·´æ ¼è¾¾å†å²", icon: "ğŸ“š" },
                { id: "istanbul", name: "ä¸œè¥¿äº¤æ±‡", description: "æŠµè¾¾ä¼Šæ–¯å¦å¸ƒå°”", icon: "ğŸŒ‰" },
                { id: "matchMaster", name: "é…å¯¹å¤§å¸ˆ", description: "å®Œæˆæ‰€æœ‰åŸå¸‚çš„å¤ä»Šé…å¯¹", icon: "ğŸ§©" },
                { id: "explorer", name: "ä¸è·¯æ¢é™©å®¶", description: "è®¿é—®æ‰€æœ‰ä¸ç»¸ä¹‹è·¯åŸå¸‚", icon: "ğŸ—ºï¸" }
            ]
        };

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            currentCity: null,
            visitedCities: [],
            unlockedAchievements: [],
            matchedPairs: {},
            progress: 0,
            selectedAncient: null,
            selectedModern: null
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            bindEventListeners();
            
            // ç»˜åˆ¶åœ°å›¾
            drawMap();
            
            // åˆå§‹åŒ–æˆå°±æ˜¾ç¤º
            updateAchievementsDisplay();
            
            // åˆå§‹åŒ–æ—¶é—´çº¿
            initTimeline();
            
            // æ›´æ–°è¿›åº¦
            updateProgress();
            
            // é»˜è®¤é€‰æ‹©è¥¿å®‰ä½œä¸ºèµ·å§‹åŸå¸‚
            setTimeout(() => {
                selectCity('xiAn');
            }, 500);
        }

        // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        function bindEventListeners() {
            // å…³é—­æˆå°±æ¨¡æ€æ¡†æŒ‰é’®
            document.getElementById('close-achievement-btn').addEventListener('click', function() {
                document.getElementById('achievement-modal').style.display = 'none';
            });
            
            // æ—¶ä»£æ ‡ç­¾åˆ‡æ¢
            document.querySelectorAll('.era-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchEraTab(this.getAttribute('data-era'));
                });
            });
        }

        // ç»˜åˆ¶ä¸ç»¸ä¹‹è·¯åœ°å›¾
        function drawMap() {
            const canvas = document.getElementById('silk-road-map');
            const ctx = canvas.getContext('2d');
            
            // è®¾ç½®Canvaså°ºå¯¸
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // ç»˜åˆ¶èƒŒæ™¯
            ctx.fillStyle = '#E9DCC9';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ä¸ç»¸ä¹‹è·¯è·¯å¾„ï¼ˆå¤ä»£ï¼‰
            ctx.beginPath();
            ctx.moveTo(canvas.width * 0.1, canvas.height * 0.5);
            ctx.bezierCurveTo(
                canvas.width * 0.3, canvas.height * 0.4,
                canvas.width * 0.5, canvas.height * 0.35,
                canvas.width * 0.9, canvas.height * 0.4
            );
            ctx.strokeStyle = '#8B4513';
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // ç»˜åˆ¶ç°ä»£äº¤é€šè·¯çº¿
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(canvas.width * 0.1, canvas.height * 0.55);
            ctx.bezierCurveTo(
                canvas.width * 0.3, canvas.height * 0.5,
                canvas.width * 0.5, canvas.height * 0.45,
                canvas.width * 0.9, canvas.height * 0.45
            );
            ctx.strokeStyle = '#4682B4';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.setLineDash([]);
            
            // ç»˜åˆ¶åŸå¸‚æ ‡è®°
            for (const cityId in gameData.cities) {
                const city = gameData.cities[cityId];
                const x = canvas.width * city.position.x;
                const y = canvas.height * city.position.y;
                
                // åˆ›å»ºåŸå¸‚æ ‡è®°å…ƒç´ 
                const marker = document.createElement('div');
                marker.className = `city-marker ${gameState.visitedCities.includes(cityId) ? 'visited' : ''}`;
                marker.style.left = `${x}px`;
                marker.style.top = `${y}px`;
                marker.setAttribute('data-city', cityId);
                marker.textContent = 'â—';
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                marker.addEventListener('click', function() {
                    selectCity(cityId);
                });
                
                const name = document.createElement('div');
                name.className = 'city-name';
                name.textContent = city.name;
                name.style.left = `${x}px`;
                name.style.top = `${y}px`;
                
                canvas.parentElement.appendChild(marker);
                canvas.parentElement.appendChild(name);
            }
        }

        // é€‰æ‹©åŸå¸‚
        function selectCity(cityId) {
            gameState.currentCity = cityId;
            const city = gameData.cities[cityId];
            
            // æ›´æ–°åŸå¸‚ä¿¡æ¯æ˜¾ç¤º
            document.getElementById('current-city').textContent = city.name;
            
            // æ›´æ–°å¤ä»£ä¿¡æ¯
            const ancientContent = document.getElementById('ancient-content');
            ancientContent.innerHTML = `
                <h3>${city.ancient.name || city.name}ï¼ˆå¤ä»£ï¼‰</h3>
                <div class="era-image">[${city.name}å¤ä»£å›¾åƒ]</div>
                <p>${city.ancient.description}</p>
                <h4>ä¸»è¦è´¸æ˜“ç‰©å“ï¼š</h4>
                <div class="goods-list">
                    ${city.ancient.goods.map(good => `<div class="goods-item">${good}</div>`).join('')}
                </div>
            `;
            
            // æ›´æ–°ç°ä»£ä¿¡æ¯
            const modernContent = document.getElementById('modern-content');
            modernContent.innerHTML = `
                <h3>${city.name}ï¼ˆç°ä»£ï¼‰</h3>
                <div class="era-image">[${city.name}ç°ä»£å›¾åƒ]</div>
                <p>${city.modern.description}</p>
                <h4>ä¸»è¦è´¸æ˜“ç‰©å“ï¼š</h4>
                <div class="goods-list">
                    ${city.modern.goods.map(good => `<div class="goods-item">${good}</div>`).join('')}
                </div>
            `;
            
            // å¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®è¯¥åŸå¸‚ï¼Œæ·»åŠ åˆ°å·²è®¿é—®åˆ—è¡¨
            if (!gameState.visitedCities.includes(cityId)) {
                gameState.visitedCities.push(cityId);
                
                // æ›´æ–°åœ°å›¾æ ‡è®°
                document.querySelector(`.city-marker[data-city="${cityId}"]`).classList.add('visited');
                
                // æ£€æŸ¥æ˜¯å¦è§£é”æˆå°±
                checkAchievements(cityId);
                
                // æ›´æ–°è¿›åº¦
                updateProgress();
            }
            
            // åˆå§‹åŒ–é…å¯¹æ¸¸æˆ
            initMatchingGame(cityId);
        }

        // åˆ‡æ¢æ—¶ä»£æ ‡ç­¾
        function switchEraTab(era) {
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.era-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.era-tab[data-era="${era}"]`).classList.add('active');
            
            // æ›´æ–°å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.era-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${era}-content`).classList.add('active');
        }

        // åˆå§‹åŒ–é…å¯¹æ¸¸æˆ
        function initMatchingGame(cityId) {
            const city = gameData.cities[cityId];
            const ancientContainer = document.getElementById('ancient-items');
            const modernContainer = document.getElementById('modern-items');
            const feedback = document.getElementById('matching-feedback');
            
            // æ¸…ç©ºå®¹å™¨å’Œåé¦ˆ
            ancientContainer.innerHTML = '';
            modernContainer.innerHTML = '';
            feedback.textContent = '';
            
            // é‡ç½®é€‰ä¸­çŠ¶æ€
            gameState.selectedAncient = null;
            gameState.selectedModern = null;
            
            // åˆå§‹åŒ–åŒ¹é…çŠ¶æ€ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            if (!gameState.matchedPairs[cityId]) {
                gameState.matchedPairs[cityId] = {};
            }
            
            // æ·»åŠ å¤ä»£ç‰©å“
            city.matches.forEach((match, index) => {
                const item = document.createElement('div');
                item.className = `matching-item ${gameState.matchedPairs[cityId][match.ancient] ? 'matched' : ''}`;
                item.textContent = match.ancient;
                item.setAttribute('data-type', 'ancient');
                item.setAttribute('data-value', match.ancient);
                item.addEventListener('click', handleMatchingItemClick);
                ancientContainer.appendChild(item);
            });
            
            // æ·»åŠ ç°ä»£ç‰©å“ï¼ˆéšæœºé¡ºåºï¼‰
            const shuffledMatches = [...city.matches].sort(() => Math.random() - 0.5);
            shuffledMatches.forEach(match => {
                const item = document.createElement('div');
                item.className = `matching-item ${gameState.matchedPairs[cityId][match.ancient] ? 'matched' : ''}`;
                item.textContent = match.modern;
                item.setAttribute('data-type', 'modern');
                item.setAttribute('data-value', match.modern);
                item.setAttribute('data-pair', match.ancient);
                item.addEventListener('click', handleMatchingItemClick);
                modernContainer.appendChild(item);
            });
        }

        // å¤„ç†é…å¯¹ç‰©å“ç‚¹å‡»
        function handleMatchingItemClick() {
            const type = this.getAttribute('data-type');
            const value = this.getAttribute('data-value');
            const cityId = gameState.currentCity;
            const feedback = document.getElementById('matching-feedback');
            
            // å¦‚æœå·²ç»åŒ¹é…æˆåŠŸï¼Œä¸å¤„ç†ç‚¹å‡»
            if (this.classList.contains('matched')) return;
            
            // æ¸…é™¤ä¹‹å‰çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.matching-item.selected').forEach(item => {
                item.classList.remove('selected');
            });
            
            // è®¾ç½®å½“å‰é€‰ä¸­çŠ¶æ€
            this.classList.add('selected');
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            if (type === 'ancient') {
                gameState.selectedAncient = {
                    element: this,
                    value: value
                };
            } else {
                gameState.selectedModern = {
                    element: this,
                    value: value,
                    pair: this.getAttribute('data-pair')
                };
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰é…å¯¹çš„é€‰ä¸­é¡¹
            if (gameState.selectedAncient && gameState.selectedModern) {
                // æ£€æŸ¥æ˜¯å¦æ­£ç¡®åŒ¹é…
                if (gameState.selectedAncient.value === gameState.selectedModern.pair) {
                    // åŒ¹é…æˆåŠŸ
                    feedback.textContent = "é…å¯¹æˆåŠŸï¼";
                    feedback.style.color = 'var(--success-color)';
                    
                    gameState.selectedAncient.element.classList.add('matched');
                    gameState.selectedModern.element.classList.add('matched');
                    gameState.selectedAncient.element.classList.remove('selected');
                    gameState.selectedModern.element.classList.remove('selected');
                    
                    // æ›´æ–°åŒ¹é…çŠ¶æ€
                    gameState.matchedPairs[cityId][gameState.selectedAncient.value] = true;
                    
                    // é‡ç½®é€‰ä¸­çŠ¶æ€
                    gameState.selectedAncient = null;
                    gameState.selectedModern = null;
                    
                    // æ£€æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰åŒ¹é…
                    checkAllMatches(cityId);
                    
                    // æ›´æ–°è¿›åº¦
                    updateProgress();
                } else {
                    // åŒ¹é…å¤±è´¥
                    feedback.textContent = "é…å¯¹é”™è¯¯ï¼Œè¯·å†è¯•ä¸€æ¬¡";
                    feedback.style.color = 'var(--error-color)';
                    
                    // çŸ­æš‚å»¶è¿Ÿåæ¸…é™¤é€‰ä¸­çŠ¶æ€
                    setTimeout(() => {
                        gameState.selectedAncient.element.classList.remove('selected');
                        gameState.selectedModern.element.classList.remove('selected');
                        gameState.selectedAncient = null;
                        gameState.selectedModern = null;
                        feedback.textContent = '';
                    }, 1000);
                }
            }
        }

        // æ£€æŸ¥åŸå¸‚æ‰€æœ‰é…å¯¹æ˜¯å¦å®Œæˆ
        function checkAllMatches(cityId) {
            const city = gameData.cities[cityId];
            const allMatched = city.matches.every(match => 
                gameState.matchedPairs[cityId][match.ancient]
            );
            
            if (allMatched) {
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                setTimeout(() => {
                    alert(`æ­å–œï¼ä½ å·²å®Œæˆ${city.name}çš„æ‰€æœ‰å¤ä»Šé…å¯¹ï¼`);
                }, 500);
            }
        }

        // æ£€æŸ¥æˆå°±
        function checkAchievements(cityId) {
            const cityAchievements = {
                'xiAn': 'start',
                'dunHuang': 'dunhuang',
                'samarKand': 'samarkand',
                'baghdad': 'baghdad',
                'istanbul': 'istanbul'
            };
            
            // æ£€æŸ¥åŸå¸‚æˆå°±
            if (cityAchievements[cityId] && !gameState.unlockedAchievements.includes(cityAchievements[cityId])) {
                unlockAchievement(cityAchievements[cityId]);
            }
            
            // æ£€æŸ¥æ˜¯å¦è®¿é—®äº†æ‰€æœ‰åŸå¸‚
            const allCitiesVisited = Object.keys(gameData.cities).every(cityId => 
                gameState.visitedCities.includes(cityId)
            );
            
            if (allCitiesVisited && !gameState.unlockedAchievements.includes('explorer')) {
                unlockAchievement('explorer');
            }
            
            // æ£€æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰é…å¯¹
            const allCitiesMatched = Object.keys(gameData.cities).every(cityId => {
                const city = gameData.cities[cityId];
                return city.matches.every(match => 
                    gameState.matchedPairs[cityId] && gameState.matchedPairs[cityId][match.ancient]
                );
            });
            
            if (allCitiesMatched && !gameState.unlockedAchievements.includes('matchMaster')) {
                unlockAchievement('matchMaster');
            }
        }

        // è§£é”æˆå°±
        function unlockAchievement(achievementId) {
            if (!gameState.unlockedAchievements.includes(achievementId)) {
                gameState.unlockedAchievements.push(achievementId);
                updateAchievementsDisplay();
                
                // æ˜¾ç¤ºæˆå°±è§£é”æ¨¡æ€æ¡†
                const achievement = gameData.achievements.find(a => a.id === achievementId);
                document.getElementById('achievement-details').innerHTML = `
                    <div style="font-size: 3rem; margin: 10px 0;">${achievement.icon}</div>
                    <h3>${achievement.name}</h3>
                    <p>${achievement.description}</p>
                `;
                document.getElementById('achievement-modal').style.display = 'flex';
            }
        }

        // æ›´æ–°æˆå°±æ˜¾ç¤º
        function updateAchievementsDisplay() {
            const container = document.getElementById('achievement-container');
            container.innerHTML = '';
            
            gameData.achievements.forEach(achievement => {
                const item = document.createElement('div');
                item.className = `achievement-item ${gameState.unlockedAchievements.includes(achievement.id) ? 'unlocked' : ''}`;
                item.innerHTML = `
                    ${gameState.unlockedAchievements.includes(achievement.id) ? achievement.icon : 'ğŸ”’'}
                    ${!gameState.unlockedAchievements.includes(achievement.id) ? '<div class="lock">ğŸ”’</div>' : ''}
                `;
                item.title = `${achievement.name}: ${achievement.description}`;
                container.appendChild(item);
            });
        }

        // åˆå§‹åŒ–æ—¶é—´çº¿
        function initTimeline() {
            const container = document.querySelector('.timeline-container');
            
            gameData.timeline.forEach((point, index) => {
                const marker = document.createElement('div');
                marker.className = 'timeline-marker';
                marker.style.left = `${(index / (gameData.timeline.length - 1)) * 100}%`;
                marker.setAttribute('data-index', index);
                marker.addEventListener('click', function() {
                    showTimelineEvent(index);
                });
                container.appendChild(marker);
            });
        }

        // æ˜¾ç¤ºæ—¶é—´çº¿äº‹ä»¶
        function showTimelineEvent(index) {
            const event = gameData.timeline[index];
            alert(`${event.year}: ${event.event}\n\n${event.description}`);
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            // è®¡ç®—è®¿é—®åŸå¸‚è¿›åº¦ (æƒé‡50%)
            const cityProgress = gameState.visitedCities.length / Object.keys(gameData.cities).length * 50;
            
            // è®¡ç®—é…å¯¹æ¸¸æˆè¿›åº¦ (æƒé‡50%)
            let matchProgress = 0;
            let totalMatches = 0;
            let completedMatches = 0;
            
            Object.keys(gameData.cities).forEach(cityId => {
                const city = gameData.cities[cityId];
                totalMatches += city.matches.length;
                
                if (gameState.matchedPairs[cityId]) {
                    completedMatches += Object.keys(gameState.matchedPairs[cityId]).length;
                }
            });
            
            if (totalMatches > 0) {
                matchProgress = (completedMatches / totalMatches) * 50;
            }
            
            gameState.progress = Math.min(cityProgress + matchProgress, 100);
            updateProgressBar();
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgressBar() {
            document.getElementById('progress-bar').style.width = `${gameState.progress}%`;
            document.getElementById('progress-percent').textContent = `${Math.round(gameState.progress)}%`;
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        window.addEventListener('load', initGame);
        
        // çª—å£å¤§å°å˜åŒ–æ—¶é‡ç»˜åœ°å›¾
        window.addEventListener('resize', drawMap);
    </script>
</body>
</html>